<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ディスプレイ製作ツール</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Old+Mincho&family=Noto+Sans+JP&family=Noto+Serif+JP&family=Kiwi+Maru&family=Hina+Mincho&family=Kaisei+Decol&family=Mochiy+Pop+One&family=Yomogi&family=Pacifico&family=Ballet&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <div class="header-container">
    <div class="header-top">
      <a href="../" class="home-btn" title="しゃちやまベース-Top">
        <span class="home-icon">🏠</span>
      </a>
      <h3>ディスプレイ製作ツール</h3>
      <div class="header-undo-redo">
        <button id="undoBtn" class="undo-redo-btn undo-btn" title="元に戻す" aria-label="元に戻す">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M7 7v10c0 1.1.9 2 2 2h10v-2H9V7z"></path>
            <path d="M15 2v2h4.59L8.41 20 10 18.41 18.59 9.82V14h2V2z" opacity="0.3"></path>
          </svg>
        </button>
        <button id="redoBtn" class="undo-redo-btn redo-btn" title="やり直す" aria-label="やり直す">
          <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
            <path d="M17 7v10c0 1.1-.9 2-2 2H5v-2h10V7z"></path>
            <path d="M9 2v2H4.41L15.59 20 14 18.41 5.41 9.82V14h-2V2z" opacity="0.3"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="main-content">
      <div class="aspect-ratio-controls">
        <label><input type="radio" name="aspectRatio" value="landscape" id="aspectLandscape"> 横長 (1920×1080)</label>
        <label><input type="radio" name="aspectRatio" value="square" id="aspectSquare" checked> 正方形 (2000×2000)</label>
        <label><input type="radio" name="aspectRatio" value="portrait" id="aspectPortrait"> 縦長 (1748×2480)</label>
      </div>
      <div class="previewWrap">
        <div class="squareViewport">
          <canvas id="mainCanvas" width="2000" height="2000"></canvas>
        </div>
      </div>
    </div>

    <aside class="sidebar" aria-label="操作パネル">

      <div class="panel">
        <strong>画像読み込み(クリックorドロップ)</strong><br>
        <label>プレビュー内で掴んで移動、スクロールで拡縮できます。</label>


        <hr style="margin:12px 0;border:none;border-top:1px solid #eee;">
        <div id="slotMainPic" class="fileSlot">
          <div class="title">立ち絵</div>
          <input id="fileMainPic" type="file" accept="image/*" style="display:none;">
          <div id="infoMainPic" class="slotInfo" style="display:none;">
            <img id="thumbMainPic" class="thumb">
            <div id="metaMainPic" class="fileMeta"></div>
            <button id="removeMainPic" class="removeBtn">削除</button>
          </div>
        </div>
        <div class="slotControls"><button id="resetMainPicPos" class="btn">デフォルト位置に戻す</button></div>


        <hr style="margin:12px 0;border:none;border-top:1px solid #eee;">
        <div style="height:10px;"></div>


        <div id="slotSubPic" class="fileSlot">
          <div class="title">立ち絵のアップ</div>
          <input id="fileSubPic" type="file" accept="image/*" style="display:none;">
          <div id="infoSubPic" class="slotInfo" style="display:none;">
            <img id="thumbSubPic" class="thumb">
            <div id="metaSubPic" class="fileMeta"></div>
            <button id="removeSubPic" class="removeBtn">削除</button>
          </div>
        </div>
        <br>

        <div class="panel">
          <strong>立ち絵アップ設定</strong><br>
          <div style="margin-top:8px;">
          <label style="display:block; margin-bottom:6px;">切り抜き形状</label>
          <div style="display:flex;flex-wrap:wrap;gap:12px;margin-bottom:8px;">
          <label style="margin-right:0px;">
          <input id="subPicShapeCircle" name="subPicShape" type="radio" value="circle" checked>丸</label>
          <label style="margin-right:0px;">
          <input id="subPicShapeDiamond" name="subPicShape" type="radio" value="diamond">ひし形</label>
          <label>
          <input id="subPicShapeHeart" name="subPicShape" type="radio" value="heart">ハート</label>
          </div>

          <div style="display:flex;gap:12px;margin-bottom:8px;align-items:flex-start;">
            <label style="padding-top:20px;">
            <input id="subPicShapeRectangle" name="subPicShape" type="radio" value="rectangle">四角形</label>

            <div style="display:flex;flex-direction:column;gap:8px;min-width:140px;">
              <label style="margin-top:4px;">四角形：縦</label>
              <div class="row">
                <input id="subPicHeightPx" type="range" min="400" max="2500" value="1200" step="10">
                <div id="subPicHeightPxVal" class="val">1200</div>
              </div>
              <label style="margin-top:4px;">四角形：横</label>
              <div class="row">
                <input id="subPicWidthPx" type="range" min="400" max="2020" value="1200" step="10">
                <div id="subPicWidthPxVal" class="val">1200</div>
              </div>
            </div>
          </div>

          <label style="margin-top:8px;">ズーム</label>
          <div class="row">
            <input id="subPicZoom" type="range" min="50" max="400" value="100">
            <div id="subPicZoomVal" class="val">100%</div>
          </div>

          <label>縦の位置</label>
          <input id="subPicCropY" type="range" min="0" max="100" value="33">

          <label for="subPicCropX" style="display:block; margin-top:8px;">横の位置</label>
          <input id="subPicCropX" type="range" min="0" max="100" value="50" step="1" style="width:100%;">

          <label style="margin-top:8px;">縁の太さ</label>
          <input id="subPicBorder" type="number" min="0" max="20" value="2">

          <div class="controlRow">
          <label style="margin-top:8px;">縁の色</label>
          <input id="subPicBorderColor" type="color" value="#000000">
          </div>

          <label style="margin-top:8px;display:block;">背景色</label>
          <input id="bgSubPic" type="color" value="#FFFF00">

          <label style="margin-top:8px;display:block;">不透明度</label>
          <div class="row watermark-opacity-row">
          <input id="bgSubPicAlpha" type="range" min="0" max="100" value="100">
          <div id="bgSubPicAlphaVal" class="val">100%</div>
          </div>
        </div>

        <div class="slotControls"><button id="resetSubPicPos" class="btn">デフォルト位置に戻す</button></div>

        <div style="height:10px;"></div>


        <hr style="margin:12px 0;border:none;border-top:1px solid #eee;">
        <strong style="display:block;margin-bottom:8px;">ウォーターマーク</strong>

        <div id="slotWmPic" class="fileSlot">
          <div class="title">ウォーターマーク</div>
          <input id="fileWmPic" type="file" accept="image/*" style="display:none;">
          <div id="infoWmPic" class="slotInfo" style="display:none;">
            <img id="thumbWmPic" class="thumb">
            <div id="metaWmPic" class="fileMeta"></div>
            <button id="removeWmPic" class="removeBtn">削除</button>
          </div>
        </div>

        <label style="margin-top:8px;display:block;">不透明度</label>
        <div class="row watermark-opacity-row">
        <input id="wmPicOpacity" type="range" min="0" max="100" value="50">
        <div id="wmPicOpacityVal" class="val">50%</div>
        </div>

        <div class="slotControls" style="margin-top:8px;">
          <button id="resetWmPicPos" class="btn">デフォルト位置に戻す</button>
        </div>


        <hr style="margin:12px 0;border:none;border-top:1px solid #eee;">


        <strong style="display:block;margin-bottom:8px;">システムロゴ</strong>
        <div id="slotSysPic" class="fileSlot">
          <div class="title">システム</div>
          <input id="fileSysPic" type="file" accept="image/*" style="display:none;">
          <div id="infoSysPic" class="slotInfo" style="display:none;">
            <img id="thumbSysPic" class="thumb">
            <div id="metaSysPic" class="fileMeta"></div>
            <button id="removeSysPic" class="removeBtn">削除</button>
          </div>
        </div>
        <div class="slotControls">
          <button id="resetSysPicPos" class="btn">デフォルト位置に戻す</button>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid #eee;">
        <div style="height:10px;"></div>

        <strong style="display:block;margin-bottom:8px;">背景</strong>
        <div id="slotBgPic" class="fileSlot">
          <div class="title">背景</div>
          <input id="fileBgPic" type="file" accept="image/*" style="display:none;">
          <div id="infoBgPic" class="slotInfo" style="display:none;">
            <img id="thumbBgPic" class="thumb">
            <div id="metaBgPic" class="fileMeta"></div>
            <button id="removeBgPic" class="removeBtn">削除</button>
          </div>
        </div>
        <div class="slotControls"><button id="resetBgPicPos" class="btn">背景をフィット</button></div>

      </div>


      <div class="panel">
        <strong>テキスト</strong><br>

        <hr style="margin:12px 0;border:none;border-top:1px solid #eee;">
        <label style="margin-top:8px;">背景色</label>

        <div class="bandRow">
          <input id="bandColor" type="color" value="#ffffff">
          <label style="margin-top:8px;">幅</label>
          <input id="bandHeight" type="number" value="1000" min="0" max="2000">
        </div>

        <div style="margin-top:8px;">
          <label style="display:block; margin-bottom:6px;">帯の向き</label>
          <label style="margin-right:12px;">
            <input id="bandOrientHorizontal" name="bandOrient" type="radio" value="horizontal" checked>横</label>
          <label>
            <input id="bandOrientVertical" name="bandOrient" type="radio" value="vertical">縦</label>
        </div>

        <hr style="margin:12px 0;border:none;border-top:1px solid #eee;">
        <label style="margin-top:8px;">フォント</label><select id="fontSelect"></select>
        <label style="margin-top:8px;">サイズ</label><input id="fontSize" type="number" value="60">
        <label style="margin-top:8px;">色</label><input id="fontColor" type="color" value="#000000">
        <label style="margin-top:8px;display:block;">文字の向き</label>
        <label style="margin-right:12px;">
          <input id="textOrientHorizontal" name="textOrient" type="radio" value="horizontal" checked>横
        </label>
        <label>
          <input id="textOrientVertical" name="textOrient" type="radio" value="vertical">縦
        </label>
        <br>

        <label>text1</label><textarea id="text1">シナリオ</textarea>
        <label>text2</label><textarea id="text2">ハンドアウト</textarea>
        <label>text3</label><textarea id="text3">お名前</textarea>

        <div class="slotControls" style="margin-top:8px;">
          <button id="resetTextPosBtn" class="btn">デフォルト位置に戻す</button>
        </div>

      </div>

      <div class="panel">
        <strong>出力形式</strong>
        <select id="format">
          <option value="image/png">PNG</option>
          <option value="image/jpeg">JPG</option>
          <option value="gif">GIF</option>
        </select>
        <button id="exportBtn" class="btn btnPrimary">エクスポート</button>
      </div>

    </aside>
  </div>

  <script src="../libs/gif.js" defer></script>

  <script src="app-state.js" defer></script>
  <script src="app-utils.js" defer></script>
  <script src="app-ui.js" defer></script>
  <script src="app-interactions.js" defer></script>
  <script src="app-interactions-hover.js" defer></script>
  <script src="app-draw.js" defer></script>

</body>
</html>